<div class="preferences-container">

  <!-- Header -->
  <div class="section-header">
    <div class="header-title">
      <h2>Sportpreferenci√°k</h2>
      <p class="subtitle">V√°laszd ki a kedvelt sport√°gaidat, hogy szem√©lyre szabott aj√°nl√°sokat kaphass</p>
    </div>
    <button class="ai-btn" (click)="toggleAiPanel()">
      <span class="ai-icon">ü§ñ</span>
      <span>AI seg√≠ts√©g</span>
    </button>
  </div>

  <!-- AI Panel -->
  <div class="ai-panel" [class.open]="showAiPanel">
    <div class="ai-panel-inner">
      <h3>ü§ñ AI-alap√∫ preferencia-gener√°l√°s</h3>
      <p>√çrj p√°r mondatot a sportos szok√°saidr√≥l, √©s az AI automatikusan be√°ll√≠tja a preferenci√°idat.</p>
      <textarea
        [(ngModel)]="aiDescription"
        placeholder="Pl. H√©tv√©gente szeretek futni, nagyj√°b√≥l 10 km-t szoktam teljes√≠teni. Kezd≈ë ker√©kp√°ros vagyok, n√©ha biciklizem munk√°ba. R√©gebben fociztem, de most ink√°bb csak n√©zem..."
        rows="4"
      ></textarea>
      <div class="ai-actions">
        <button class="btn-secondary" (click)="toggleAiPanel()">M√©gse</button>
        <button class="btn-ai-generate" (click)="generateWithAi()" [disabled]="aiLoading || !aiDescription.trim()">
          <span *ngIf="!aiLoading">‚ú® Gener√°l√°s</span>
          <span *ngIf="aiLoading" class="loading-dots">Elemz√©s...</span>
        </button>
      </div>

      <!-- AI Javaslatok -->
      <div class="ai-suggestions" *ngIf="aiSuggestions.length > 0">
        <h4>Javasolt preferenci√°k:</h4>
        <div class="suggestion-list">
          <div class="suggestion-item" *ngFor="let s of aiSuggestions">
            <span class="suggestion-icon">{{ getSportIcon(s.sport_type) }}</span>
            <div class="suggestion-info">
              <strong>{{ getSportName(s.sport_type) }}</strong>
              <span class="suggestion-level">{{ s.skill_level }} ¬∑ {{ s.interest_level }}/10 √©rdekl≈ëd√©s</span>
            </div>
          </div>
        </div>
        <button class="btn-apply" (click)="applyAiSuggestions()">
          ‚úÖ Alkalmaz
        </button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-state" *ngIf="loading">
    <div class="spinner"></div>
    <p>Sport√°gak bet√∂lt√©se...</p>
  </div>

  <!-- Sports Grid -->
  <div class="sports-grid" *ngIf="!loading">
    <div
      class="sport-card"
      *ngFor="let sport of sports"
      [class.selected]="selectedSports.has(sport.id)"
      (click)="toggleSport(sport.id)"
    >
      <div class="sport-card-header">
        <span class="sport-emoji">{{ sport.icon }}</span>
        <span class="sport-name">{{ sport.name }}</span>
        <span class="check-mark" *ngIf="selectedSports.has(sport.id)">‚úì</span>
      </div>

      <!-- Preference controls - csak ha ki van v√°lasztva -->
      <div class="pref-controls" *ngIf="selectedSports.has(sport.id)" (click)="$event.stopPropagation()">

        <!-- Szint -->
        <div class="control-group">
          <label>Szint</label>
          <div class="skill-buttons">
            <button
              *ngFor="let skill of skillLevels"
              class="skill-btn"
              [class.active]="getPreference(sport.id)?.skill_level === skill.value"
              (click)="setSkillLevel(sport.id, skill.value)"
              [title]="skill.label"
            >
              {{ skill.icon }} {{ skill.label }}
            </button>
          </div>
        </div>

        <!-- √ârdekl≈ëd√©si szint -->
        <div class="control-group">
          <label>√ârdekl≈ëd√©s: <span class="interest-value">{{ getPreference(sport.id)?.interest_level }}/10</span></label>
          <div class="interest-label-text">{{ getInterestLabel(getPreference(sport.id)?.interest_level || 5) }}</div>
          <input
            type="range"
            min="1"
            max="10"
            [value]="getPreference(sport.id)?.interest_level || 7"
            (input)="setInterestLevel(sport.id, +$any($event.target).value)"
            class="interest-slider"
          />
          <div class="slider-labels">
            <span>1</span>
            <span>5</span>
            <span>10</span>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- √ñsszefoglal√°s √©s ment√©s -->
  <div class="save-section" *ngIf="selectedSports.size > 0">
    <div class="summary">
      <span class="summary-count">{{ selectedSports.size }} sport√°g kiv√°lasztva</span>
    </div>
    <button
      class="btn-save"
      (click)="savePreferences()"
      [disabled]="saving"
    >
      <span *ngIf="!saving && !saveSuccess">üíæ Ment√©s</span>
      <span *ngIf="saving">Ment√©s...</span>
      <span *ngIf="saveSuccess && !saving">‚úÖ Elmentve!</span>
    </button>
  </div>

  <!-- √úres √°llapot -->
  <div class="empty-state" *ngIf="!loading && selectedSports.size === 0">
    <p>M√©g nem v√°lasztott√°l sport√°gat. Kattints b√°rmelyikre a hozz√°ad√°shoz!</p>
  </div>

</div>