<div class="profile-edit-container">
  <div class="page-header">
    <h1>Profil szerkeszt√©se</h1>
    <p>Friss√≠tsd az adataidat √©s a be√°ll√≠t√°saidat</p>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Form -->
  <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="edit-form" *ngIf="!loading">
    <!-- Profile Picture Section -->
    <div class="form-section">
      <h2 class="section-title">Profilk√©p</h2>
      
      <div class="profile-picture-upload">
        <div class="current-picture">
          <div class="picture-preview" *ngIf="imagePreview">
            <img [src]="imagePreview" alt="Profile Preview" />
          </div>
          <div class="picture-placeholder" *ngIf="!imagePreview">
            üë§
          </div>
        </div>
        
        <div class="upload-controls">
          <label for="profile_picture" class="btn btn-outline">
            üì∑ K√©p kiv√°laszt√°sa
          </label>
          <input
            type="file"
            id="profile_picture"
            accept="image/*"
            (change)="onFileSelected($event)"
            style="display: none"
          />
          <small>Maximum 5MB, JPG vagy PNG form√°tum</small>
        </div>
      </div>
    </div>

    <!-- Basic Info Section -->
    <div class="form-section">
      <h2 class="section-title">Alapadatok</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="first_name">Keresztn√©v *</label>
          <input
            type="text"
            id="first_name"
            formControlName="first_name"
            class="form-control"
            [class.is-invalid]="f['first_name'].invalid && f['first_name'].touched"
          />
          <div *ngIf="f['first_name'].invalid && f['first_name'].touched" class="invalid-feedback">
            <span *ngIf="f['first_name'].errors?.['required']">A keresztn√©v k√∂telez≈ë.</span>
            <span *ngIf="f['first_name'].errors?.['minlength']">Minimum 2 karakter.</span>
          </div>
        </div>

        <div class="form-group">
          <label for="last_name">Vezet√©kn√©v *</label>
          <input
            type="text"
            id="last_name"
            formControlName="last_name"
            class="form-control"
            [class.is-invalid]="f['last_name'].invalid && f['last_name'].touched"
          />
          <div *ngIf="f['last_name'].invalid && f['last_name'].touched" class="invalid-feedback">
            <span *ngIf="f['last_name'].errors?.['required']">A vezet√©kn√©v k√∂telez≈ë.</span>
            <span *ngIf="f['last_name'].errors?.['minlength']">Minimum 2 karakter.</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="bio">Bemutatkoz√°s</label>
        <textarea
          id="bio"
          formControlName="bio"
          class="form-control"
          rows="4"
          placeholder="√çrj magadr√≥l n√©h√°ny mondatot..."
          [class.is-invalid]="f['bio'].invalid && f['bio'].touched"
        ></textarea>
        <small>{{ f['bio'].value?.length || 0 }} / 500 karakter</small>
        <div *ngIf="f['bio'].invalid && f['bio'].touched" class="invalid-feedback">
          <span *ngIf="f['bio'].errors?.['maxlength']">Maximum 500 karakter.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="phone_number">Telefonsz√°m</label>
        <input
          type="tel"
          id="phone_number"
          formControlName="phone_number"
          class="form-control"
          placeholder="+36 30 123 4567"
        />
      </div>
    </div>

    <!-- Location Section -->
    <div class="form-section">
      <h2 class="section-title">Alap√©rtelmezett helysz√≠n</h2>

      <button type="button" class="btn btn-outline" (click)="getCurrentLocation()">
        üìç Jelenlegi helyzet haszn√°lata
      </button>

      <div class="form-group">
        <label for="default_location_name">Helysz√≠n neve</label>
        <input
          type="text"
          id="default_location_name"
          formControlName="default_location_name"
          class="form-control"
          placeholder="pl: Budapest"
        />
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="default_latitude">Sz√©less√©g</label>
          <input
            type="number"
            id="default_latitude"
            formControlName="default_latitude"
            class="form-control"
            step="0.000001"
            placeholder="47.4979"
          />
        </div>

        <div class="form-group">
          <label for="default_longitude">Hossz√∫s√°g</label>
          <input
            type="number"
            id="default_longitude"
            formControlName="default_longitude"
            class="form-control"
            step="0.000001"
            placeholder="19.0402"
          />
        </div>
      </div>

      <div class="form-group">
        <label for="default_search_radius">Keres√©si sug√°r (km)</label>
        <input
          type="number"
          id="default_search_radius"
          formControlName="default_search_radius"
          class="form-control"
          min="1"
          max="100"
        />
        <small>Alap√©rtelmezett t√°vols√°g az esem√©nyek keres√©s√©hez</small>
      </div>
    </div>

    <!-- Sport Preferences Section -->
    <div class="form-section">
      <div class="section-header">
        <h2 class="section-title">Sport√°g preferenci√°k</h2>
        <button type="button" class="btn btn-outline btn-small" (click)="addSportPreference()">
          ‚ûï √öj preferencia
        </button>
      </div>

      <div *ngIf="sportPreferences.length > 0" class="preferences-list">
        <div *ngFor="let pref of sportPreferences" class="preference-item">
          <div class="preference-info">
            <span class="preference-sport">{{ pref.sport_type_detail?.name }}</span>
            <span class="preference-level">{{ getSkillLevelLabel(pref.skill_level) }}</span>
            <span class="preference-interest">√ârdekl≈ëd√©s: {{ pref.interest_level }}/10</span>
          </div>
          <button 
            type="button" 
            class="btn-delete" 
            (click)="deleteSportPreference(pref.id)"
          >
            üóëÔ∏è
          </button>
        </div>
      </div>

      <p *ngIf="sportPreferences.length === 0" class="empty-message">
        M√©g nincs megadva preferencia. Adj hozz√° sport√°gakat a jobb aj√°nl√°sok√©rt!
      </p>
    </div>

    <!-- Submit Buttons -->
    <div class="form-actions">
      <button type="submit" class="btn btn-primary btn-large" [disabled]="saving || profileForm.invalid">
        <span *ngIf="!saving">üíæ Ment√©s</span>
        <span *ngIf="saving">Ment√©s...</span>
      </button>
      <button type="button" class="btn btn-outline btn-large" routerLink="/profile" [disabled]="saving">
        M√©gse
      </button>
    </div>
  </form>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Profil bet√∂lt√©se...</p>
  </div>
</div>
