<div class="profile-edit-container">
  <div class="page-header">
    <h1>Profil szerkeszt√©se</h1>
    <p>Friss√≠tsd az adataidat √©s a be√°ll√≠t√°saidat</p>
  </div>

  <!-- Messages -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Form -->
  <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="edit-form" *ngIf="!loading">
    <!-- Profile Picture Section -->
    <div class="form-section">
      <h2 class="section-title">Profilk√©p</h2>
      
      <div class="profile-picture-upload">
        <div class="current-picture">
          <div class="picture-preview" *ngIf="imagePreview">
            <img [src]="imagePreview" alt="Profile Preview" />
          </div>
          <div class="picture-placeholder" *ngIf="!imagePreview">
            üë§
          </div>
        </div>
        
        <div class="upload-controls">
          <label for="profile_picture" class="btn btn-outline">
            üì∑ K√©p kiv√°laszt√°sa
          </label>
          <input
            type="file"
            id="profile_picture"
            accept="image/*"
            (change)="onFileSelected($event)"
            style="display: none"
          />
          <small>Maximum 5MB, JPG vagy PNG form√°tum</small>
        </div>
      </div>
    </div>

    <!-- Basic Info Section -->
    <div class="form-section">
      <h2 class="section-title">Alapadatok</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="first_name">Keresztn√©v *</label>
          <input
            type="text"
            id="first_name"
            formControlName="first_name"
            class="form-control"
            [class.is-invalid]="f['first_name'].invalid && f['first_name'].touched"
          />
          <div *ngIf="f['first_name'].invalid && f['first_name'].touched" class="invalid-feedback">
            <span *ngIf="f['first_name'].errors?.['required']">A keresztn√©v k√∂telez≈ë.</span>
            <span *ngIf="f['first_name'].errors?.['minlength']">Minimum 2 karakter.</span>
          </div>
        </div>

        <div class="form-group">
          <label for="last_name">Vezet√©kn√©v *</label>
          <input
            type="text"
            id="last_name"
            formControlName="last_name"
            class="form-control"
            [class.is-invalid]="f['last_name'].invalid && f['last_name'].touched"
          />
          <div *ngIf="f['last_name'].invalid && f['last_name'].touched" class="invalid-feedback">
            <span *ngIf="f['last_name'].errors?.['required']">A vezet√©kn√©v k√∂telez≈ë.</span>
            <span *ngIf="f['last_name'].errors?.['minlength']">Minimum 2 karakter.</span>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="bio">Bemutatkoz√°s</label>
        <textarea
          id="bio"
          formControlName="bio"
          class="form-control"
          rows="4"
          placeholder="√çrj magadr√≥l n√©h√°ny mondatot..."
          [class.is-invalid]="f['bio'].invalid && f['bio'].touched"
        ></textarea>
        <small>{{ f['bio'].value?.length || 0 }} / 500 karakter</small>
        <div *ngIf="f['bio'].invalid && f['bio'].touched" class="invalid-feedback">
          <span *ngIf="f['bio'].errors?.['maxlength']">Maximum 500 karakter.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="phone_number">Telefonsz√°m</label>
        <input
          type="tel"
          id="phone_number"
          formControlName="phone_number"
          class="form-control"
          placeholder="+36 30 123 4567"
        />
      </div>
    </div>

    <!-- Location Section -->
    <div class="form-section">
      <h2 class="section-title">Alap√©rtelmezett helysz√≠n</h2>

      <div class="form-group">
        <label for="default_location_name">Helysz√≠n neve vagy c√≠me</label>
        
        <div class="location-input-wrapper" style="display: flex; gap: 10px; align-items: flex-start; margin-bottom: 5px;">
          <input
            type="text"
            id="default_location_name"
            formControlName="default_location_name"
            class="form-control"
            placeholder="Pl. Budapest, V√°ci √∫t 1."
            (keyup.enter)="searchLocationByAddress()"
            style="flex: 1;"
          />
          
          <button 
            type="button" 
            class="btn btn-primary" 
            (click)="searchLocationByAddress()" 
            [disabled]="searchingLocation">
            <span *ngIf="!searchingLocation">üîç Keres√©s</span>
            <span *ngIf="searchingLocation">‚è≥ ...</span>
          </button>

          <button 
            type="button" 
            class="btn btn-outline" 
            (click)="getCurrentLocation()">
            üìç Jelenlegi helyzet
          </button>
        </div>

        <div class="geocoding-results" *ngIf="showGeocodingResults && geocodingResults.length > 0">
          <div class="results-header" style="display: flex; justify-content: space-between; align-items: center; background: #f8f9fa; padding: 8px; border: 1px solid #ddd; border-bottom: none; border-radius: 4px 4px 0 0;">
            <strong>V√°lassz a tal√°latok k√∂z√ºl:</strong>
            <button type="button" class="btn-close" (click)="closeGeocodingResults()" style="background: none; border: none; font-size: 1.2rem; cursor: pointer;">√ó</button>
          </div>
          <ul class="results-list" style="list-style: none; padding: 0; margin: 0; border: 1px solid #ddd; max-height: 200px; overflow-y: auto; border-radius: 0 0 4px 4px;">
            <li *ngFor="let result of geocodingResults" 
                (click)="selectGeocodingResult(result)"
                style="padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; background: #fff;"
                onmouseover="this.style.background='#f0f0f0'"
                onmouseout="this.style.background='#fff'">
              {{ result.display_name }}
            </li>
          </ul>
        </div>
      </div>

      <div class="form-group" style="margin-top: 20px;">
        <label for="default_search_radius">Keres√©si sug√°r (km)</label>
        <input
          type="number"
          id="default_search_radius"
          formControlName="default_search_radius"
          class="form-control"
          min="1"
          max="100"
        />
        <small class="text-muted">Alap√©rtelmezett t√°vols√°g az esem√©nyek keres√©s√©hez</small>
      </div>
    </div>

    <!-- Submit Buttons -->
    <div class="form-actions">
      <button type="submit" class="btn btn-primary btn-large" [disabled]="saving || profileForm.invalid">
        <span *ngIf="!saving">üíæ Ment√©s</span>
        <span *ngIf="saving">Ment√©s...</span>
      </button>
      <button type="button" class="btn btn-outline btn-large" routerLink="/profile" [disabled]="saving">
        M√©gse
      </button>
    </div>
  </form>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Profil bet√∂lt√©se...</p>
  </div>

  <!-- ‚úÖ Sport Preferences ‚Äî k√ºl√∂n szekci√≥ a form ALATT, √∂n√°ll√≥an kezeli a ment√©st -->
  <div class="form-section" style="margin-top: 30px;" *ngIf="!loading">
    <app-sport-preferences></app-sport-preferences>
  </div>
</div>