<div class="profile-container" *ngIf="!loading && user">
  <!-- Profile Header -->
  <div class="profile-header">
    <div class="profile-banner" [style.backgroundImage]="getBannerBackground()"></div>
    <div class="profile-info">
      <div class="profile-avatar-wrapper">
        <div class="profile-avatar" *ngIf="!user.profile_picture">
          {{ getUserInitials() }}
        </div>
        <img 
          *ngIf="user.profile_picture" 
          [src]="user.profile_picture" 
          alt="Profile Picture"
          class="profile-avatar-img"
        />
      </div>
      <div class="profile-details">
        <h1 class="profile-name">{{ user.full_name }}</h1>
        <p class="profile-username">{{ '@' + user.username }}</p>
        <p class="profile-member-since">üìÖ Tag {{ getMemberSince() }} √≥ta</p>
      </div>
      <div *ngIf="isOwnProfile" class="profile-actions">
        <button class="btn btn-primary" (click)="editProfile()" [routerLink]="['/profile/edit']" [queryParams]="{tab: 'personal'}">
          ‚úèÔ∏è Profil szerkeszt√©se
        </button>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Profile Content -->
  <div class="profile-content">
    <!-- Left Column -->
    <div class="profile-main">
      <!-- About Section -->
      <div class="section-card">
        <h2 class="section-title">R√≥lam</h2>
        <div *ngIf="user.bio" class="bio-text">
          {{ user.bio }}
        </div>
        <div *ngIf="!user.bio" class="empty-message">
          M√©g nincs bemutatkoz√°s. Szerkeszd a profilod √©s adj hozz√° egy bemutatkoz√°st!
        </div>
      </div>
      
      <!-- Sport Preferences -->
      <div class="section-card">
        <div class="section-header-with-action">
          <h2 class="section-title" style="margin-bottom: 0;">Sport√°g preferenci√°k</h2>
          <button *ngIf="isOwnProfile" class="btn btn-primary" [routerLink]="['/profile/edit']" [queryParams]="{tab: 'preferences'}">
            ‚úèÔ∏è Szerkeszt√©s
          </button>
        </div>
        <div *ngIf="sportPreferences.length > 0" class="preferences-list">
          
          <div *ngFor="let pref of sportPreferences" class="preference-item">
            <div class="preference-header">
              
              <span class="preference-sport">
                {{ getSportIcon(pref.sport_type) }} {{ getSportName(pref.sport_type) }}
              </span>
              
              <span class="preference-level" [class]="pref.skill_level">
                {{ getSkillLevelLabel(pref.skill_level) }}
              </span>
            </div>
            
            <div class="preference-interest">
              <span class="interest-label">√ârdekl≈ëd√©si szint:</span>
              <div class="interest-bar">
                <div 
                  class="interest-fill" 
                  [style.width.%]="pref.interest_level * 10"
                ></div>
              </div>
              <span class="interest-value">{{ pref.interest_level }}/10</span>
            </div>
          </div>

        </div>
        
        <div *ngIf="sportPreferences.length === 0" class="empty-message">
          M√©g nincs megadva sport√°g preferencia. Adj hozz√° preferenci√°kat a jobb aj√°nl√°sok√©rt!
        </div>
      </div>

      <!-- Statistics -->
      <div class="section-card">
        <h2 class="section-title">Statisztik√°k √©s Esem√©nyek</h2>
        
        <div class="stats-grid">
          <div class="stat-item" [class.clickable]="isOwnProfile" [class.active]="showCreated" (click)="toggleCreatedEvents()">
            <div class="stat-icon">üìù</div>
            <div class="stat-value">{{ user.created_events_count || 0 }}</div>
            <div class="stat-label">L√©trehozott esem√©ny</div>
          </div>
          <div class="stat-item" [class.clickable]="isOwnProfile" [class.active]="showParticipated" (click)="toggleParticipatedEvents()">
            <div class="stat-icon">üèÉ</div>
            <div class="stat-value">{{ user.participated_events_count || 0 }}</div>
            <div class="stat-label">R√©szv√©tel</div>
          </div>
        </div>

        <div class="stats-dropdown" *ngIf="showCreated || showParticipated">
          <div *ngIf="loadingEvents" class="dropdown-loading">
            <div class="spinner small"></div> Bet√∂lt√©s...
          </div>

          <div *ngIf="showCreated && !loadingEvents" class="dropdown-content">
            <h4 class="dropdown-title">Saj√°t szervez√©s≈± esem√©nyeim</h4>
            <div class="dropdown-list">
              <a *ngFor="let event of createdEvents" [routerLink]="['/events', event.id]" class="dropdown-item">
                <div class="dropdown-event-main">
                  <span class="dropdown-event-date">{{ event.start_date_time | date:'yyyy.MM.dd.' }}</span>
                  <span class="dropdown-event-title">{{ event.title }}</span>
                </div>
              </a>
              <div *ngIf="createdEvents.length === 0" class="dropdown-empty">M√©g nem hozt√°l l√©tre esem√©nyt.</div>
            </div>
          </div>

          <div *ngIf="showParticipated && !loadingEvents" class="dropdown-content">
            <h4 class="dropdown-title">Esem√©nyek, amiken r√©szt vettem</h4>
            <div class="dropdown-list">
              <a *ngFor="let event of participatedEvents" [routerLink]="['/events', event.id]" class="dropdown-item">
                <div class="dropdown-event-main">
                  <span class="dropdown-event-date">{{ event.start_date_time | date:'yyyy.MM.dd.' }}</span>
                  <span class="dropdown-event-title">{{ event.title }}</span>
                </div>
              </a>
              <div *ngIf="participatedEvents.length === 0" class="dropdown-empty">M√©g nem jelentkezt√©l esem√©nyre.</div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Sidebar -->
    <div class="profile-sidebar">

       <div class="organizer-rating-section" *ngIf="user.organizer_rating">
        <h4 class="rating-title">Szervez≈ëi megb√≠zhat√≥s√°g</h4>
        
        <div class="rating-card">
          <div class="score-display">
            <span class="score-big">{{ user.organizer_rating }}</span>
            <span class="score-max">/ 5</span>
          </div>
          
          <div class="stars-display">
            <span class="star" *ngFor="let i of [1,2,3,4,5]" 
                  [class.active]="i <= (user.organizer_rating || 0)">‚òÖ</span>
          </div>
          
          <div class="rating-text">
            <small>A r√©sztvev≈ëk visszajelz√©sei alapj√°n</small>
          </div>
        </div>
      </div>
      <!-- Contact Info -->
      <div class="sidebar-card">
        <h3 class="sidebar-title">El√©rhet≈ës√©g</h3>
        <div class="contact-list">
          <div class="contact-item">
            <span class="contact-icon">üìß</span>
            <span class="contact-value">{{ user.email }}</span>
          </div>
          <div class="contact-item" *ngIf="user.phone_number">
            <span class="contact-icon">üì±</span>
            <span class="contact-value">{{ user.phone_number }}</span>
          </div>
        </div>
      </div>

      <!-- Location Info -->
      <div class="sidebar-card" *ngIf="isOwnProfile && user.default_location_name">
        <h3 class="sidebar-title">Alap√©rtelmezett helysz√≠n</h3>
        <div class="location-info">
          <div class="location-icon">üìç</div>
          <div class="location-details">
            <div class="location-name">{{ user.default_location_name }}</div>
            <div class="location-search">
              Keres√©si sug√°r: {{ user.default_search_radius }} km
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Links -->
      <div class="sidebar-card">
        <h3 class="sidebar-title">Gyors linkek</h3>
        <div class="quick-links">
          <a routerLink="/my-events" class="quick-link">
            <span class="link-icon">üìÖ</span>
            <span class="link-text">Saj√°t esem√©nyek</span>
          </a>
          <a routerLink="/events" class="quick-link">
            <span class="link-icon">üîç</span>
            <span class="link-text">Esem√©nyek b√∂ng√©sz√©se</span>
          </a>
          <a routerLink="/create-event" class="quick-link">
            <span class="link-icon">‚ûï</span>
            <span class="link-text">√öj esem√©ny</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading -->
<div *ngIf="loading" class="loading-container">
  <div class="spinner"></div>
  <p>Profil bet√∂lt√©se...</p>
</div>
