<div class="event-list-container">
  <div class="page-header">
    <h1>Sportesem√©nyek</h1>
    <p>Tal√°ld meg a t√∂k√©letes esem√©nyt a k√∂zeledben</p>
  </div>

  <!-- Filters Section -->
  <div class="filters-container">
    <div class="filters-header">
      <h3>Sz≈±r≈ëk</h3>
      <button class="btn-text" (click)="resetFilters()">Sz≈±r≈ëk t√∂rl√©se</button>
    </div>

    <div class="filters-grid">
      <!-- Search -->
      <div class="filter-group full-width">
        <label>Keres√©s</label>
        <input
          type="text"
          [(ngModel)]="filters.search"
          (ngModelChange)="applyFilters()"
          placeholder="Esem√©ny neve, helysz√≠n..."
          class="form-control"
        />
      </div>

      <!-- Sport Type -->
      <div class="filter-group">
        <label>Sport√°g</label>
        <select
          [(ngModel)]="filters.sport_type"
          (ngModelChange)="applyFilters()"
          class="form-control"
        >
          <option [ngValue]="undefined">√ñsszes sport√°g</option>
          <option *ngFor="let type of sportTypes" [value]="type.id">
            {{ type.name }}
          </option>
        </select>
      </div>

      <!-- Status -->
      <div class="filter-group">
        <label>St√°tusz</label>
        <select
          [(ngModel)]="filters.status"
          (ngModelChange)="applyFilters()"
          class="form-control"
        >
          <option value="">√ñsszes</option>
          <option value="upcoming">K√∂zelg≈ë</option>
          <option value="ongoing">Folyamatban</option>
          <option value="completed">Befejezett</option>
        </select>
      </div>

      <!-- Difficulty -->
      <div class="filter-group">
        <label>Neh√©zs√©g</label>
        <select
          [(ngModel)]="filters.difficulty"
          (ngModelChange)="applyFilters()"
          class="form-control"
        >
          <option [ngValue]="undefined">√ñsszes szint</option>
          <option value="easy">Kezd≈ë</option>
          <option value="medium">K√∂zepes</option>
          <option value="hard">Halad√≥</option>
        </select>
      </div>

      <!-- Is Free -->
      <div class="filter-group">
        <label>T√≠pus</label>
        <select
          [(ngModel)]="filters.is_free"
          (ngModelChange)="applyFilters()"
          class="form-control"
        >
          <option [ngValue]="undefined">√ñsszes</option>
          <option [value]="true">Ingyenes</option>
          <option [value]="false">Fizet≈ës</option>
        </select>
      </div>

      <!-- Ordering -->
      <div class="filter-group">
        <label>Rendez√©s</label>
        <select
          [(ngModel)]="filters.ordering"
          (ngModelChange)="applyFilters()"
          class="form-control"
        >
          <option value="start_date_time">Id≈ëpont (legk√∂zelebbi)</option>
          <option value="-start_date_time">Id≈ëpont (legt√°volabbi)</option>
          <option value="created_at">L√©trehoz√°s (leg√∫jabb)</option>
          <option value="-created_at">L√©trehoz√°s (legr√©gebbi)</option>
        </select>
      </div>

      <!-- Location Search -->
      <div class="filter-group full-width">
        <div class="location-filter">
          <label class="checkbox-label">
            <input
              type="checkbox"
              [(ngModel)]="useLocation"
              (change)="toggleLocationSearch()"
            />
            <span>Keres√©s a k√∂rny√©kemen</span>
          </label>
          <div *ngIf="useLocation" class="radius-control">
            <label>Sug√°r: {{ searchRadius }} km</label>
            <input
              type="range"
              [(ngModel)]="searchRadius"
              (ngModelChange)="applyFilters()"
              min="1"
              max="50"
              class="range-slider"
            />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Results -->
  <div class="results-section">
    <div class="results-header">
      <p class="results-count">
        <strong>{{ totalCount }}</strong> esem√©ny tal√°lhat√≥
      </p>
      
      <!-- View Mode Toggle -->
      <div class="view-toggle">
        <button 
          class="view-btn" 
          [class.active]="viewMode === 'list'"
          (click)="switchViewMode('list')"
        >
          üìã Lista
        </button>
        <button 
          class="view-btn" 
          [class.active]="viewMode === 'map'"
          (click)="switchViewMode('map')"
        >
          üó∫Ô∏è T√©rk√©p
        </button>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="loading-container">
      <div class="spinner"></div>
      <p>Esem√©nyek bet√∂lt√©se...</p>
    </div>

    <!-- Events Grid -->
     <div *ngIf="!loading && events.length > 0 && viewMode === 'list'" class="events-grid">
      <div
        *ngFor="let event of events"
        class="event-card"
        [routerLink]="['/events', event.id]"
      >
        <div
          class="event-image"
          [style.background-image]="event.primary_image ? 'url(' + event.primary_image + ')' : 'none'"
        >
          <div class="event-badge" [class.free]="event.is_free">
            {{ event.is_free ? 'Ingyenes' : (event.price + ' Ft') }}
          </div>
          <div *ngIf="event.distance" class="distance-badge">
            üìç {{ event.distance }} km
          </div>
        </div>

        <div class="event-content">
          <div class="event-meta">
            <span class="event-sport-type">
              {{ event.sport_type_detail?.name }}
            </span>
            <span class="event-difficulty" [class]="event.difficulty">
              {{ getDifficultyLabel(event.difficulty) }}
            </span>
          </div>

          <h3 class="event-title">{{ event.title }}</h3>

          <div class="event-details">
            <div class="event-detail">
              <span class="detail-icon">üìÖ</span>
              {{ getEventDate(event.start_date_time) }}
            </div>
            <div class="event-detail">
              <span class="detail-icon">üïí</span>
              {{ getEventTime(event.start_date_time) }}
            </div>
            <div class="event-detail">
              <span class="detail-icon">üìç</span>
              {{ event.location_name }}
            </div>
          </div>

          <div class="event-footer">
            <div class="event-participants">
              <span class="participants-icon">üë•</span>
              <span class="participants-text">
                {{ event.participants_count }} / {{ event.max_participants }}
              </span>
            </div>
            <div class="event-status" [class.full]="event.is_full">
              {{ event.is_full ? 'Betelt' : event.available_spots + ' hely' }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!loading && events.length > 0 && viewMode === 'map'" class="map-view">
      <app-map 
        [latitude]="userLocation?.lat || 47.4979" 
        [longitude]="userLocation?.lng || 19.0402"
        [zoom]="12"
        [height]="'600px'"
        [markers]="mapMarkers"
      ></app-map>
    </div>

    <!-- No Results -->
    <div *ngIf="!loading && events.length === 0" class="no-results">
      <div class="no-results-icon">üîç</div>
      <h3>Nincs tal√°lat</h3>
      <p>Pr√≥b√°lj meg m√°s sz≈±r≈ëket haszn√°lni</p>
      <button class="btn btn-primary" (click)="resetFilters()">
        Sz≈±r≈ëk t√∂rl√©se
      </button>
    </div>

    <!-- Pagination -->
    <div *ngIf="!loading && events.length > 0" class="pagination">
      <button
        class="btn btn-outline"
        [disabled]="!hasPrevious"
        (click)="previousPage()"
      >
        ‚Üê El≈ëz≈ë
      </button>
      <span class="page-info">{{ currentPage }}. oldal</span>
      <button
        class="btn btn-outline"
        [disabled]="!hasNext"
        (click)="nextPage()"
      >
        K√∂vetkez≈ë ‚Üí
      </button>
    </div>
  </div>
</div>
