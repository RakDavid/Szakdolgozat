<div class="event-detail-container" *ngIf="!loading && event" [style.backgroundImage]="getDynamicBackground(event.sport_type_detail?.name)">
  <div class="event-hero" [style.background-image]="event.images && event.images.length > 0 ? 'url(' + event.images[0].image + ')' : 'none'">
    <div class="hero-overlay">
      <div class="hero-content">
        <div class="event-badges">
          <span class="badge badge-sport">{{ event.sport_type_detail?.name }}</span>
          <span class="badge badge-difficulty" [class]="event.difficulty">
            {{ getDifficultyLabel(event.difficulty) }}
          </span>
          <span class="badge badge-status" [class]="event.status">
            {{ getStatusLabel(event.status) }}
          </span>
        </div>
        <h1 class="event-title">{{ event.title }}</h1>
      </div>
    </div>
  </div>

  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <div class="event-content">
    
    <div class="event-main">
      
      <div class="info-cards">
        <div class="info-card">
          <div class="info-icon">ğŸ“…</div>
          <div class="info-content">
            <div class="info-label">IdÅ‘pont</div>
            <div class="info-value">{{ getEventDate(event.start_date_time) }}</div>
            <div class="info-subvalue">{{ getEventTime(event.start_date_time) }}</div>
          </div>
        </div>

        <div class="info-card">
          <div class="info-icon">ğŸ“</div>
          <div class="info-content">
            <div class="info-label">HelyszÃ­n</div>
            <div class="info-value">{{ event.location_name }}</div>
            <div class="info-subvalue" *ngIf="event.location_address" [title]="event.location_address">
              {{ formatShortAddress(event.location_address) }}
            </div>
          </div>
        </div>

        <div class="info-card">
          <div class="info-icon">ğŸ‘¥</div>
          <div class="info-content">
            <div class="info-label">RÃ©sztvevÅ‘k</div>
            <div class="info-value">{{ event.participants_count }} / {{ event.max_participants }}</div>
            <div class="info-subvalue" [class.full]="event.is_full">
              {{ event.is_full ? 'Betelt' : event.available_spots + ' szabad hely' }}
            </div>
          </div>
        </div>

        <div class="info-card">
          <div class="info-icon">ğŸ’°</div>
          <div class="info-content">
            <div class="info-label">RÃ©szvÃ©teli dÃ­j</div>
            <div class="info-value">{{ event.is_free ? 'Ingyenes' : event.price + ' Ft' }}</div>
          </div>
        </div>
      </div>

      <div class="section-card">
        <h2 class="section-title">LeÃ­rÃ¡s</h2>
        <p class="event-description">{{ event.description }}</p>
      </div>

      <div class="section-card" *ngIf="event.notes">
        <h2 class="section-title">TovÃ¡bbi informÃ¡ciÃ³k</h2>
        <p class="event-notes">{{ event.notes }}</p>
      </div>

      <div class="section-card">
        <h2 class="section-title">TÃ©rkÃ©p</h2>
        <app-map 
          [latitude]="event.latitude" 
          [longitude]="event.longitude"
          [height]="'400px'"
          [markers]="[{lat: event.latitude, lng: event.longitude, popup: event.location_name}]"
        ></app-map>
      </div>

      <div class="section-card">
        <h2 class="section-title">RÃ©sztvevÅ‘k ({{ participants.length }})</h2>
        <div class="participants-list" *ngIf="participants.length > 0">
          <div class="participant-item" *ngFor="let participant of participants" style="cursor: pointer;" [routerLink]="['/users', participant.user]">
            <div class="participant-avatar">
              <img *ngIf="participant.user_detail?.profile_picture" [src]="participant.user_detail?.profile_picture" alt="Avatar" />
              <span *ngIf="!participant.user_detail?.profile_picture">
                {{ participant.user_detail?.last_name?.charAt(0) }}{{ participant.user_detail?.first_name?.charAt(0) }}
              </span>
            </div>
            <div class="participant-info">
              <div class="participant-name-row">
                <span class="participant-name">{{ participant.user_detail?.full_name }}</span>
                <span *ngIf="participant.user === event.creator" class="creator-badge-small">
                  ğŸ‘‘ SzervezÅ‘
                </span>
              </div>
              <div class="participant-status" [class]="participant.status" *ngIf="participant.status !== 'confirmed'">
                {{ getParticipantStatusLabel(participant.status) }}
              </div>
            </div>
          </div>
        </div>
        <p *ngIf="participants.length === 0" class="no-participants">
          MÃ©g nincs rÃ©sztvevÅ‘. LÃ©gy te az elsÅ‘!
        </p>
      </div>

    </div> 
    <div class="event-sidebar">
      
      <div class="action-card">
        
        <div *ngIf="isCreator" class="creator-actions">
          <h3>SajÃ¡t esemÃ©ny</h3>
          <p class="action-description">Te hoztad lÃ©tre ezt az esemÃ©nyt</p>
          
          <div *ngIf="pendingParticipants.length > 0" class="pending-section">
            <h4 class="pending-title">
              â³ FÃ¼ggÅ‘ben lÃ©vÅ‘ kÃ©rÃ©sek ({{ pendingParticipants.length }})
            </h4>
            <div *ngFor="let p of pendingParticipants" class="pending-item">
              <div class="pending-info">
                <div class="pending-name">{{ p.user_detail?.full_name }}</div>
                <div class="pending-username">{{ '@' + p.user_detail?.username }}</div>
                <div *ngIf="p.notes" class="pending-notes">ğŸ’¬ "{{ p.notes }}"</div>
                <div class="pending-time">{{ p.joined_at | date:'MMM d, HH:mm' }}</div>
              </div>
              <div class="pending-actions" *ngIf="!event.is_past">
                <button class="btn btn-success btn-small" (click)="approveParticipant(p.id)">
                  âœ“ JÃ³vÃ¡hagyÃ¡s
                </button>
                <button class="btn btn-danger btn-small" (click)="rejectParticipant(p.id)">
                  âœ• ElutasÃ­tÃ¡s
                </button>
              </div>
            </div>
          </div>

          <div *ngIf="pendingParticipants.length === 0 && event.requires_approval" class="no-pending">
            Nincs fÃ¼ggÅ‘ben lÃ©vÅ‘ kÃ©rÃ©s
          </div>

          <div class="creator-btn-group" *ngIf="!event.is_past">
            <button class="btn btn-outline btn-block" (click)="editEvent()">
              âœï¸ SzerkesztÃ©s
            </button>
            <button class="btn btn-danger btn-block" (click)="deleteEvent()">
              ğŸ—‘ï¸ TÃ¶rlÃ©s
            </button>
          </div>
        </div>

        <div *ngIf="!isCreator">

          <div class="rating-section" *ngIf="canRateEvent() && !ratingSuccess" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 12px;">            
            <h3 style="margin-bottom: 15px; font-size: 1.2rem;">Ã‰rtÃ©keld az esemÃ©nyt!</h3>
            <div *ngIf="ratingError" class="alert alert-error">{{ ratingError }}</div>

            <div class="stars" style="font-size: 2rem; cursor: pointer; color: #ccc; margin-bottom: 15px;">
              <span (click)="setRating(1)" [style.color]="ratingValue >= 1 ? '#FFD700' : '#ccc'">â˜…</span>
              <span (click)="setRating(2)" [style.color]="ratingValue >= 2 ? '#FFD700' : '#ccc'">â˜…</span>
              <span (click)="setRating(3)" [style.color]="ratingValue >= 3 ? '#FFD700' : '#ccc'">â˜…</span>
              <span (click)="setRating(4)" [style.color]="ratingValue >= 4 ? '#FFD700' : '#ccc'">â˜…</span>
              <span (click)="setRating(5)" [style.color]="ratingValue >= 5 ? '#FFD700' : '#ccc'">â˜…</span>
            </div>

            <textarea 
              [(ngModel)]="feedbackText" 
              placeholder="Ãrj egy rÃ¶vid szÃ¶veges Ã©rtÃ©kelÃ©st (opcionÃ¡lis)..." 
              class="form-control" 
              rows="3" 
              style="width: 100%; margin-bottom: 15px;">
            </textarea>

            <button 
              class="btn btn-primary" 
              (click)="submitRating()" 
              [disabled]="ratingValue === 0 || isSubmittingRating">
              <span *ngIf="!isSubmittingRating">â­ Ã‰rtÃ©kelÃ©s bekÃ¼ldÃ©se</span>
              <span *ngIf="isSubmittingRating">KÃ¼ldÃ©s...</span>
            </button>
          </div>

          <div class="alert alert-success" *ngIf="ratingSuccess" style="margin-top: 30px;">
            KÃ¶szÃ¶njÃ¼k az Ã©rtÃ©kelÃ©st!
          </div>
          
          <div *ngIf="canJoinEvent() && !showJoinForm">
            <h3>Csatlakozz!</h3>
            <p class="action-description">
              {{ event.requires_approval ? 'JelentkezÃ©sed jÃ³vÃ¡hagyÃ¡sra vÃ¡r' : 'Azonnal csatlakozhatsz' }}
            </p>
            <button class="btn btn-primary btn-block" (click)="toggleJoinForm()" [disabled]="event.is_full">
              {{ event.is_full ? 'âŒ Betelt' : 'âœ… JelentkezÃ©s' }}
            </button>
          </div>

          <div *ngIf="showJoinForm" class="join-form">
            <h3>JelentkezÃ©s</h3>
            <div class="form-group">
              <label>Ãœzenet a szervezÅ‘nek (opcionÃ¡lis)</label>
              <textarea
                [(ngModel)]="joinNotes"
                placeholder="Pl: KezdÅ‘ vagyok, de szeretnÃ©k tanulni..."
                rows="4"
                class="form-control"
              ></textarea>
            </div>
            <button class="btn btn-primary btn-block" (click)="joinEvent()" [disabled]="joining">
              <span *ngIf="!joining">JelentkezÃ©s</span>
              <span *ngIf="joining">JelentkezÃ©s...</span>
            </button>
            <button class="btn btn-outline btn-block" (click)="toggleJoinForm()" [disabled]="joining">
              MÃ©gse
            </button>
          </div>

          <div *ngIf="event.user_participation_status">
            <h3>RÃ©szt veszel</h3>
            <p class="action-description">
              StÃ¡tusz: {{ getParticipantStatusLabel(event.user_participation_status.status) }}
            </p>
            <button 
              *ngIf="canLeaveEvent()" 
              class="btn btn-danger btn-block" 
              (click)="leaveEvent()" 
              [disabled]="leaving"
            >
              <span *ngIf="!leaving">âŒ LemondÃ¡s</span>
              <span *ngIf="leaving">LemondÃ¡s...</span>
            </button>
          </div>
        </div>

        <div class="details-summary">
          <div class="summary-item">
            <span class="summary-label">â±ï¸ IdÅ‘tartam:</span>
            <span class="summary-value">{{ event.duration_minutes || '-' }} perc</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">ğŸ“Š Min. lÃ©tszÃ¡m:</span>
            <span class="summary-value">{{ event.min_participants }} fÅ‘</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">ğŸ“ JÃ³vÃ¡hagyÃ¡s:</span>
            <span class="summary-value">{{ event.requires_approval ? 'SzÃ¼ksÃ©ges' : 'Automatikus' }}</span>
          </div>
        </div>
      </div> <button class="btn btn-outline btn-block" routerLink="/events">
        â† Vissza az esemÃ©nyekhez
      </button>

    </div> 
    </div> </div> <div *ngIf="loading" class="loading-container">
  <div class="spinner"></div>
  <p>EsemÃ©ny betÃ¶ltÃ©se...</p>
</div>