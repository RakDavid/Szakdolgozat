<div class="create-event-container">
  <div class="page-header">
    <h1>√öj esem√©ny l√©trehoz√°sa</h1>
    <p>Hozz l√©tre egy sportrendezv√©nyt √©s h√≠vd meg a k√∂z√∂ss√©get!</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Form -->
  <form [formGroup]="eventForm" (ngSubmit)="onSubmit()" class="event-form">
    <!-- Basic Info Section -->
    <div class="form-section">
      <h2 class="section-title">Alapadatok</h2>

      <div class="form-group">
        <label for="title">Esem√©ny neve *</label>
        <input
          type="text"
          id="title"
          formControlName="title"
          class="form-control"
          [class.is-invalid]="(f['title'].invalid && f['title'].touched) || errors.title"
          placeholder="pl: Kisp√°ly√°s foci h√©tv√©g√©re"
        />
        <div *ngIf="f['title'].invalid && f['title'].touched" class="invalid-feedback">
          <span *ngIf="f['title'].errors?.['required']">A c√≠m megad√°sa k√∂telez≈ë.</span>
          <span *ngIf="f['title'].errors?.['minlength']">Minimum 5 karakter sz√ºks√©ges.</span>
        </div>
        <div *ngIf="errors.title" class="invalid-feedback">{{ errors.title[0] }}</div>
      </div>

      <div class="form-group">
        <label for="sport_type">Sport√°g *</label>
        <select
          id="sport_type"
          formControlName="sport_type"
          class="form-control"
          [class.is-invalid]="(f['sport_type'].invalid && f['sport_type'].touched) || errors.sport_type"
        >
          <option [ngValue]="null">V√°lassz sport√°gat</option>
          <option *ngFor="let type of (sportTypes || [])" [value]="type.id">
            {{ type.name }}
          </option>
        </select>
        <div *ngIf="f['sport_type'].invalid && f['sport_type'].touched" class="invalid-feedback">
          <span *ngIf="f['sport_type'].errors?.['required']">A sport√°g kiv√°laszt√°sa k√∂telez≈ë.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="description">Le√≠r√°s *</label>
        <textarea
          id="description"
          formControlName="description"
          class="form-control"
          rows="5"
          [class.is-invalid]="(f['description'].invalid && f['description'].touched) || errors.description"
          placeholder="√çrd le az esem√©ny r√©szleteit, mi v√°rhat√≥, kire sz√°m√≠tasz..."
        ></textarea>
        <div *ngIf="f['description'].invalid && f['description'].touched" class="invalid-feedback">
          <span *ngIf="f['description'].errors?.['required']">A le√≠r√°s megad√°sa k√∂telez≈ë.</span>
          <span *ngIf="f['description'].errors?.['minlength']">Minimum 20 karakter sz√ºks√©ges.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="difficulty">Neh√©zs√©gi szint *</label>
        <select id="difficulty" formControlName="difficulty" class="form-control">
          <option value="easy">Kezd≈ë - B√°rki csatlakozhat</option>
          <option value="medium">K√∂zepes - Alapvet≈ë tapasztalat sz√ºks√©ges</option>
          <option value="hard">Halad√≥ - Gyakorlott j√°t√©kosok</option>
        </select>
      </div>
    </div>

    <!-- Date & Time Section -->
    <div class="form-section">
      <h2 class="section-title">Id≈ëpont</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="start_date_time">Kezd√©s id≈ëpontja *</label>
          <input
            type="datetime-local"
            id="start_date_time"
            formControlName="start_date_time"
            class="form-control"
            [class.is-invalid]="(f['start_date_time'].invalid && f['start_date_time'].touched) || errors.start_date_time"
          />
          <div *ngIf="f['start_date_time'].invalid && f['start_date_time'].touched" class="invalid-feedback">
            <span *ngIf="f['start_date_time'].errors?.['required']">A kezd√©s id≈ëpontja k√∂telez≈ë.</span>
          </div>
        </div>

        <div class="form-group">
          <label for="duration_minutes">Id≈ëtartam (perc) *</label>
          <input
            type="number"
            id="duration_minutes"
            formControlName="duration_minutes"
            class="form-control"
            min="15"
            [class.is-invalid]="f['duration_minutes'].invalid && f['duration_minutes'].touched"
          />
          <div *ngIf="f['duration_minutes'].invalid && f['duration_minutes'].touched" class="invalid-feedback">
            <span *ngIf="f['duration_minutes'].errors?.['min']">Minimum 15 perc sz√ºks√©ges.</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Location Section -->
    <div class="form-section">
      <h2 class="section-title">Helysz√≠n</h2>

      <div class="location-actions">
        <button type="button" class="btn btn-outline" (click)="getCurrentLocation()">
          üìç Jelenlegi helyzet haszn√°lata
        </button>
        <button type="button" class="btn btn-primary" (click)="searchLocationByAddress()" [disabled]="searchingLocation">
          <span *ngIf="!searchingLocation">üîç Keres√©s c√≠m alapj√°n</span>
          <span *ngIf="searchingLocation">Keres√©s...</span>
        </button>
      </div>

      <div class="form-group">
        <label for="location_name">Helysz√≠n neve *</label>
        <input
          type="text"
          id="location_name"
          formControlName="location_name"
          class="form-control"
          [class.is-invalid]="f['location_name'].invalid && f['location_name'].touched"
          placeholder="pl: V√°rosi sportp√°lya"
        />
        <div *ngIf="f['location_name'].invalid && f['location_name'].touched" class="invalid-feedback">
          <span *ngIf="f['location_name'].errors?.['required']">A helysz√≠n neve k√∂telez≈ë.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="location_address">Pontos c√≠m *</label>
        <input
          type="text"
          id="location_address"
          formControlName="location_address"
          class="form-control"
          placeholder="pl: Budapest, P√©lda utca 12. vagy Szeged, Dugonics t√©r"
        />
        <small>Add meg a c√≠met √©s kattints a "Keres√©s c√≠m alapj√°n" gombra</small>
      </div>

      <!-- Geocoding Results -->
      <div *ngIf="showGeocodingResults && geocodingResults.length > 0" class="geocoding-results">
        <div class="results-header">
          <h4>Tal√°latok ({{ geocodingResults.length }})</h4>
          <button type="button" class="btn-close" (click)="closeGeocodingResults()">‚úï</button>
        </div>
        <div class="results-list">
          <div 
            *ngFor="let result of geocodingResults" 
            class="result-item"
            (click)="selectGeocodingResult(result)"
          >
            <span class="result-icon">üìç</span>
            <span class="result-text">{{ result.display_name }}</span>
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="latitude">Sz√©less√©g (automatikusan kit√∂ltve)</label>
          <input
            type="number"
            id="latitude"
            formControlName="latitude"
            class="form-control"
            step="0.000001"
            readonly
            placeholder="Automatikusan kit√∂ltve"
          />
        </div>

        <div class="form-group">
          <label for="longitude">Hossz√∫s√°g (automatikusan kit√∂ltve)</label>
          <input
            type="number"
            id="longitude"
            formControlName="longitude"
            class="form-control"
            step="0.000001"
            readonly
            placeholder="Automatikusan kit√∂ltve"
          />
        </div>
      </div>
    </div>

    <!-- Participants Section -->
    <div class="form-section">
      <h2 class="section-title">R√©sztvev≈ëk</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="min_participants">Minimum l√©tsz√°m *</label>
          <input
            type="number"
            id="min_participants"
            formControlName="min_participants"
            class="form-control"
            min="1"
            [class.is-invalid]="f['min_participants'].invalid && f['min_participants'].touched"
          />
          <small>H√°ny f≈ë alatt nem j√∂n l√©tre az esem√©ny</small>
        </div>

        <div class="form-group">
          <label for="max_participants">Maximum l√©tsz√°m *</label>
          <input
            type="number"
            id="max_participants"
            formControlName="max_participants"
            class="form-control"
            min="2"
            [class.is-invalid]="f['max_participants'].invalid && f['max_participants'].touched"
          />
        </div>
      </div>
    </div>

    <!-- Settings Section -->
    <div class="form-section">
      <h2 class="section-title">Be√°ll√≠t√°sok</h2>

      <div class="checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="is_public" />
          <span>Nyilv√°nos esem√©ny (mindenki l√°thatja)</span>
        </label>
      </div>

      <div class="checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="requires_approval" />
          <span>J√≥v√°hagy√°s sz√ºks√©ges a csatlakoz√°shoz</span>
        </label>
      </div>

      <div class="checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="is_free" />
          <span>Ingyenes esem√©ny</span>
        </label>
      </div>

      <div class="form-group" *ngIf="!f['is_free'].value">
        <label for="price">R√©szv√©teli d√≠j (Ft) *</label>
        <input
          type="number"
          id="price"
          formControlName="price"
          class="form-control"
          min="0"
          [class.is-invalid]="f['price'].invalid && f['price'].touched"
          placeholder="1000"
        />
        <div *ngIf="f['price'].invalid && f['price'].touched" class="invalid-feedback">
          <span *ngIf="f['price'].errors?.['required']">Az √°r megad√°sa k√∂telez≈ë.</span>
        </div>
      </div>

      <div class="form-group">
        <label for="notes">Megjegyz√©sek</label>
        <textarea
          id="notes"
          formControlName="notes"
          class="form-control"
          rows="3"
          placeholder="Tov√°bbi fontos inform√°ci√≥k..."
        ></textarea>
      </div>
    </div>

    <!-- Submit Buttons -->
    <div class="form-actions">
      <button type="submit" class="btn btn-primary btn-large" [disabled]="loading || eventForm.invalid">
        <span *ngIf="!loading">‚úÖ Esem√©ny l√©trehoz√°sa</span>
        <span *ngIf="loading">L√©trehoz√°s...</span>
      </button>
      <button type="button" class="btn btn-outline btn-large" routerLink="/events" [disabled]="loading">
        M√©gse
      </button>
    </div>
  </form>
</div>
