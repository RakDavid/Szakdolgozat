<div class="my-events-container">
  <div class="page-header">
    <h1>SajÃ¡t esemÃ©nyek</h1>
    <p>A lÃ©trehozott Ã©s a jelentkezett esemÃ©nyeid egy helyen</p>
  </div>

  <!-- Ãœzenetek -->
  <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert alert-error">{{ errorMessage }}</div>

  <!-- Tabs -->
  <div class="tabs">
    <button
      class="tab-button"
      [class.active]="activeTab === 'created'"
      (click)="switchTab('created')"
    >
      ğŸ“ LÃ©trehozott esemÃ©nyek ({{ createdEvents.length }})
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'participating'"
      (click)="switchTab('participating')"
    >
      ğŸ‘¥ RÃ©szvÃ©telek ({{ participatingEvents.length }})
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'pending'"
      (click)="switchTab('pending')"
    >
      â³ JÃ³vÃ¡hagyÃ¡sok ({{ pendingRequests.length }})
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>EsemÃ©nyek betÃ¶ltÃ©se...</p>
  </div>

  <!-- ==================== LÃ‰TREHOZOTT ESEMÃ‰NYEK TAB ==================== -->
  <div *ngIf="!loading && activeTab === 'created'" class="tab-content">
    <div *ngIf="createdEvents.length > 0" class="events-grid">
      <div
        *ngFor="let event of createdEvents"
        class="event-card"
        [routerLink]="['/events', event.id]"
      >
        <div class="event-image-container">
          <div
            *ngIf="event.primary_image"
            class="event-image"
            [style.background-image]="'url(' + event.primary_image + ')'"
          ></div>
          <div *ngIf="!event.primary_image" class="event-map">
            <app-map
              [latitude]="event.latitude"
              [longitude]="event.longitude"
              [zoom]="14"
              [height]="'200px'"
              [markers]="[{lat: event.latitude, lng: event.longitude, popup: event.location_name}]"
            ></app-map>
          </div>
          <div class="event-status-badge" [class]="event.status">
            {{ getStatusLabel(event.status) }}
          </div>
        </div>

        <div class="event-content">
          <div class="event-meta">
            <span class="event-sport-type">{{ event.sport_type_detail?.name }}</span>
            <span class="event-difficulty" [class]="event.difficulty">
              {{ getDifficultyLabel(event.difficulty) }}
            </span>
          </div>
          <h3 class="event-title">{{ event.title }}</h3>
          <div class="event-details">
            <div class="event-detail"><span class="detail-icon">ğŸ“…</span>{{ getEventDate(event.start_date_time) }}</div>
            <div class="event-detail"><span class="detail-icon">ğŸ•’</span>{{ getEventTime(event.start_date_time) }}</div>
            <div class="event-detail"><span class="detail-icon">ğŸ“</span>{{ event.location_name }}</div>
          </div>
          <div class="event-footer">
            <div class="event-participants">
              <span class="participants-icon">ğŸ‘¥</span>
              {{ event.participants_count }} / {{ event.max_participants }}
            </div>
            <div class="event-status-indicator" [class.full]="event.is_full">
              {{ event.is_full ? 'Betelt' : event.available_spots + ' hely' }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="createdEvents.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ“</div>
      <h3>MÃ©g nincs lÃ©trehozott esemÃ©nyed</h3>
      <p>Hozz lÃ©tre egy Ãºj esemÃ©nyt Ã©s hÃ­vd meg a kÃ¶zÃ¶ssÃ©get!</p>
      <button class="btn btn-primary" routerLink="/create-event">â• Ãšj esemÃ©ny lÃ©trehozÃ¡sa</button>
    </div>
  </div>

  <!-- ==================== RÃ‰SZVÃ‰TELEK TAB ==================== -->
  <div *ngIf="!loading && activeTab === 'participating'" class="tab-content">
    <div *ngIf="participatingEvents.length > 0" class="events-grid">
      <div
        *ngFor="let event of participatingEvents"
        class="event-card"
        [routerLink]="['/events', event.id]"
      >
        <div class="event-image-container">
          <div
            *ngIf="event.primary_image"
            class="event-image"
            [style.background-image]="'url(' + event.primary_image + ')'"
          ></div>
          <div *ngIf="!event.primary_image" class="event-map">
            <app-map
              [latitude]="event.latitude"
              [longitude]="event.longitude"
              [zoom]="14"
              [height]="'200px'"
              [markers]="[{lat: event.latitude, lng: event.longitude, popup: event.location_name}]"
            ></app-map>
          </div>
          <div class="event-status-badge" [class]="event.status">{{ getStatusLabel(event.status) }}</div>
          <div *ngIf="event.user_participation_status" class="participation-badge" [class]="event.user_participation_status.status">
            {{ event.user_participation_status.status === 'confirmed' ? 'âœ“ MegerÅ‘sÃ­tve' :
               event.user_participation_status.status === 'pending' ? 'â³ FÃ¼ggÅ‘ben' :
               event.user_participation_status.status }}
          </div>
        </div>
        <div class="event-content">
          <div class="event-meta">
            <span class="event-sport-type">{{ event.sport_type_detail?.name }}</span>
            <span class="event-difficulty" [class]="event.difficulty">{{ getDifficultyLabel(event.difficulty) }}</span>
          </div>
          <h3 class="event-title">{{ event.title }}</h3>
          <div class="event-details">
            <div class="event-detail"><span class="detail-icon">ğŸ“…</span>{{ getEventDate(event.start_date_time) }}</div>
            <div class="event-detail"><span class="detail-icon">ğŸ•’</span>{{ getEventTime(event.start_date_time) }}</div>
            <div class="event-detail"><span class="detail-icon">ğŸ“</span>{{ event.location_name }}</div>
          </div>
          <div class="event-footer">
            <div class="event-participants">
              <span class="participants-icon">ğŸ‘¥</span>
              {{ event.participants_count }} / {{ event.max_participants }}
            </div>
            <div class="creator-info">
              <span class="creator-label">SzervezÅ‘:</span>
              <span class="creator-name">{{ event.creator_detail?.full_name }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="participatingEvents.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ‘¥</div>
      <h3>MÃ©g nem jelentkeztÃ©l esemÃ©nyekre</h3>
      <p>BÃ¶ngÃ©szd az elÃ©rhetÅ‘ esemÃ©nyeket Ã©s csatlakozz!</p>
      <button class="btn btn-primary" routerLink="/events">ğŸ” EsemÃ©nyek bÃ¶ngÃ©szÃ©se</button>
    </div>
  </div>

  <!-- ==================== JÃ“VÃHAGYÃSOK TAB ==================== -->
  <div *ngIf="!loading && activeTab === 'pending'" class="tab-content">

    <div *ngIf="pendingRequests.length > 0" class="pending-list">
      <div *ngFor="let req of pendingRequests" class="pending-card">
        <!-- EsemÃ©ny fejlÃ©c -->
        <div class="pending-event-header" [routerLink]="['/events', req.event.id]">
          <span class="pending-event-title">{{ req.event.title }}</span>
          <span class="pending-event-date">ğŸ“… {{ getEventDate(req.event.start_date_time) }}</span>
        </div>

        <!-- RÃ©sztvevÅ‘ adatok -->
        <div class="pending-participant">
          <div class="pending-avatar">
            <img
              *ngIf="req.participant.user_detail?.profile_picture"
              [src]="req.participant.user_detail?.profile_picture"
              alt="Avatar"
            />
            <span *ngIf="!req.participant.user_detail?.profile_picture">
              {{ req.participant.user_detail?.first_name?.charAt(0) }}{{ req.participant.user_detail?.last_name?.charAt(0) }}
            </span>
          </div>

          <div class="pending-info">
            <div class="pending-name">{{ req.participant.user_detail?.full_name }}</div>
            <div class="pending-username">{{ '@' }}{{ req.participant.user_detail?.username }}</div>
            <div *ngIf="req.participant.notes" class="pending-notes">
              ğŸ’¬ "{{ req.participant.notes }}"
            </div>
            <div class="pending-time">
              {{ req.participant.joined_at | date:'yyyy. MM. dd. HH:mm' }}
            </div>
          </div>

          <div class="pending-actions">
            <button
              class="btn btn-success btn-small"
              (click)="approveParticipant(req.event.id, req.participant.id)"
              [disabled]="approvingId === req.participant.id || rejectingId === req.participant.id"
            >
              <span *ngIf="approvingId === req.participant.id">...</span>
              <span *ngIf="approvingId !== req.participant.id">âœ“ JÃ³vÃ¡hagyÃ¡s</span>
            </button>
            <button
              class="btn btn-danger btn-small"
              (click)="rejectParticipant(req.event.id, req.participant.id)"
              [disabled]="approvingId === req.participant.id || rejectingId === req.participant.id"
            >
              <span *ngIf="rejectingId === req.participant.id">...</span>
              <span *ngIf="rejectingId !== req.participant.id">âœ• ElutasÃ­tÃ¡s</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="pendingRequests.length === 0" class="empty-state">
      <div class="empty-icon">âœ…</div>
      <h3>Nincs fÃ¼ggÅ‘ben lÃ©vÅ‘ kÃ©rÃ©s</h3>
      <p>Minden jelentkezÃ©st kezelted, vagy nincs olyan esemÃ©nyed, ahol jÃ³vÃ¡hagyÃ¡s szÃ¼ksÃ©ges.</p>
    </div>
  </div>

</div>